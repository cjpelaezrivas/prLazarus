<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Creation FX: Composición sobre herencia&nbsp;- prLázarus</title>
    <meta name='Language' content='es' />
    <meta name='Content-Language' content='es' />
    <meta name="author" content="Carlos J. Peláez Rivas" />
    <meta name="description" content="prLázarus - Blog de programación y diario de desarrollo" />
    <meta name="keywords" content="lazarus,surazal,prlazarus,blog,programacion,coding,code,desarrollo,development,software,engineer,java,carlos,pelaez,cjpelaez,cjpelaezrivas,malaga,spain" />
    <meta property="og:site_name" content="prLázarus" />
    <meta property="og:title" content="prLázarus - Blog de programación" />
    <meta property="og:description" content="prLázarus - Blog de programación y diario de desarrollo" />
    <meta name="twitter:title" content="prLázarus - Blog de programación">
    <meta name="twitter:description" content="prLázarus - Blog de programación y diario de desarrollo" />
    <link rel="icon" type="image/x-icon" href="media/images/favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="media/images/favicon.ico" />
    <link rel="canonical" href="https://prlazarus.es/md_2019_07_18">
    <link rel="stylesheet" href="static/lib/bootstrap-4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/lib/fontawesome-4.7/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="static/lib/hint-2.5.1/css/hint.base.min.css" />
    <link rel="stylesheet" type="text/css" href="static/lib/lightbox-2.10/css/lightbox.min.css" />
    <link rel="stylesheet" type="text/css" href="static/lib/cookieconsent2-3.1.0/css/cookieconsent.min.css" />
    <link rel="stylesheet" type="text/css" href="static/css/base.css" />
    <link rel="stylesheet" type="text/css" href="static/css/main.css" />
    <link rel="stylesheet" type="text/css" href="static/css/entry.css" />
    <link rel="stylesheet" type="text/css" href="static/css/project.css" />
    <link rel="stylesheet" type="text/css" href="static/css/toc.css" />
    <link rel="stylesheet" type="text/css" href="static/css/code.css" />
    <link rel="stylesheet" type="text/css" href="static/css/code-github.min.css" />
    <link rel="stylesheet" type="text/css" href="static/css/print.css" media="print" />
    <script src="static/lib/jquery-3.3.1/js/jquery.min.js"></script>
    <script src="static/lib/bootstrap-4.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="static/lib/stickytabs-1.2.0/js/stickytabs.js"></script>
    <script src="static/lib/scrolltotop-1.0/js/scrolltotop.js"></script>
    <script src="static/lib/lightbox-2.10/js/lightbox.min.js"></script>
    <script>
      lightbox.option({
        'albumLabel': "Imagen %1 de %2",
        'fadeDuration': 250,
        'resizeDuration': 250,
        'wrapAround': true,
        'disable': true
      })
    </script>
    <script src="lib/cookieconsent2-3.1.0/js/cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function() {
        window.cookieconsent.initialise({
          "palette": {
            "popup": {
              "background": "#d4d4d4",
              "text": "#151515"
            },
            "button": {
              "background": "#003379",
              "text": "#ffffff"
            }
          },
          "content": {
            "message": "Este sitio web utiliza cookies propias y de terceros para que tengas la mejor experiencia de usuario posible. Si continuas navegando estás aceptando el uso de las mencionadas cookies y la política de cookies.",
            "dismiss": "Cerrar mensaje",
            "link": "Más información",
            "href": "https://prlazarus.es/md_cookies_policy.html"
          }
        })
      });
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWTT0T2YZ0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'G-PWTT0T2YZ0');
    </script>
  </head>
  <body>
    <div class="container-fluid main-container">
      <link rel="stylesheet" type="text/css" href="static/css/navbar.css" />
      <div id="navbar">
        <div id="zoneA">
          <div class="content">
            <a href="./">
              <div id="logo"></div>
            </a>
            <h1 id="title">
              prLázarus
            </h1>
            <h2 id="subtitle">
              Blog sobre el desarrollo de proyectos, ingeniería software y tutoriales
            </h2>
          </div>
        </div>
        <div id="zoneB">
          <div class="content">
            <div id="menu">
              <a class="menuItem" href="./"><i class="fa fa-home"></i><span class="text"> Página principal</span></a>
              <a class="menuItem" href="./md_projects.html"><i class="fa fa-rocket"></i><span class="text"> Proyectos</span></a>
              <a class="menuItem" href="https://cjpelaezrivas.dev"><i class="fa fa-user-circle"></i><span class="text"> Sobre mí</span></a>
            </div>
          </div>
        </div>
      </div>
      <div class="fluid-row" id="header">
        <h1 class="title toc-ignore ">Project Creation FX: Composición sobre herencia</h1>
        <div class="date"><em>jueves, 18 de julio de 2019</em></div>
        <div id="entry_section">
          <div id="time_section"><b>Tiempo de lectura:</b> 5 minutos</div>
        </div>
        <div id="tag_section">
          <b>Etiquetas: </b>
          <a class="tag" href="md_search.html?tag=Diario de desarrollo">Diario de desarrollo</a>
          <a class="tag" href="md_search.html?tag=Project Creation FX">Project Creation FX</a>
        </div>
      </div>
      <b>Tabla de contenido</b>
      <div class="table-of-contents">
        <ul>
          <li><a href="#herencia-vs.-composici%C3%B3n">Herencia vs. composición</a></li>
          <li><a href="#opini%C3%B3n-actual">Opinión actual</a></li>
        </ul>
      </div>
      <div class="section">
        <p>Hola otra vez. <br>
          De nuevo, hace ya algunos meses que no escribo nada y la verdad que ya va siendo hora de aparecer con algo nuevo por aquí. En esta ocasión vamos a tratar un tema bastante interesante y al que le estoy dedicando últimamente mis esfuerzos.</p>
        <p>Se trata de la decisión de cambiar todo el sistema de entidades de <a href="https://cjpelaezrivas.dev/ProjectCreationFX">Project Creation FX</a>, de herencia y polimorfismo al uso de sistema de componentes. Resumiendo un poco, Project Creation FX es un motor de juegos 2D, una herramienta que permite desarrollar prototipos y pequeños juegos de manera sencilla. Las entidades, dentro de este ámbito lo son todo: personajes, enemigos, partículas, los <em>tiles</em> del mapa, puertas, luces, y un largo etcétera. Es decir, cualquier cosa que forme parte de un juego es una entidad.</p>
        <h2 id="herencia-vs.-composici%C3%B3n">Herencia vs. composición</h2>
        <p>Inicialmente la idea de usar herencia y polimorfismo no parece tan mala idea. Todo son entidades, y a partir de ahí los diferentes objetos heredan los unos de los otros compartiendo características, variables y comportamientos. Si tomamos por ejemplo la clase de los enemigos, todos tiene vida, ¿verdad? De esta clase heredarán todos los tipos de enemigos que tenga el juego con su cantidad de vida correspondiente.</p>
        <p>Usar estas técnicas no parece una mala idea, la lógica que controla todos los aspectos de niveles de vida está en una clase superior de la que heredan todos los monstruos de nuestro juego. Ahora piensa en los ciudadanos de las ciudades del juego. También tienen vida, pero no atacan al personaje, por lo que no son enemigos. Debemos mover toda la lógica a una clase superior que englobe a los ciudadanos y enemigos, llamémosla personajes no controlables. Bien, y ahora ¿qué pasa con el personaje del jugador? También tiene vida. ¿Volvemos a mover la lógica que controla la vida a una clase superior que englobe a personajes controlables y no controlables? Creo que entendéis ya la idea.</p>
        <p>Cada vez que deseamos hacer un cambio, vemos que existen conflictos con las clases y es necesario realizar modificaciones en muchos objetos distintos. Aunque la herencia es útil, no parece que sea la mejor solución para resolver este problema.</p>
        <p>Vamos a sacar toda la información de la vida de una entidad a una clase nueva. Esta clase almacenará la vida actual y la cantidad máxima de una entidad. A este tipo de clase la llamaremos <em>componente</em>. Toda la lógica relacionada con el componente, como curarse o recibir daño, estará en otra clase, a la que llamaremos <em>sistema</em>. La entidad estará compuesta de diferentes componentes y sistemas que interactúan los unos con los otros y dan la forma a esa entidad única.</p>
        <p>Componentes de control, de colisiones, de renderizado, de sonido, de inventario, de movimiento,... Las opciones son casi infinitas. Cualquier lógica que se desee incluir a una entidad se le podrá añadir en forma de componente o sistema. Todo esto, añadido a la idea de modificar <em>en caliente</em> las entidades para añadirle, cambiarle o quitarle características hacen que esta solución parezca bastante mejor que la anterior.</p>
        <p>Desde mi punto de vista, y según lo que estoy viviendo al aplicar este cambio al proyecto es que la complejidad aumenta en gran medida. No todo iba a ser bueno. Pero el nivel de reutilización de código se dispara. La idea de utilizar la orientación a objetos en un juego aparece de forma natural al enfrentarnos al problema, sin embargo, partir los objetos en partes más pequeñas e independientes puede resultar un poco más farragoso. Debemos de dejar de ver a las entidades como objetos con lógica, para pasar a verlos como contenedores de componentes y sistemas.</p>
        <h2 id="opini%C3%B3n-actual">Opinión actual</h2>
        <p>Hasta ahora he notado ventajas enormes, por ejemplo, en los componentes de renderizado. Antes, indicaba que un objeto era <em>renderizable</em> usando una interfaz. Al implementarla debía crear las funciones para dibujar en pantalla la entidad correspondiente. Tenía el mismo código para pintar repetido en todos los proyectos y demos.</p>
        <p>Ahora tengo un componente de dimensiones para almacenar el tamaño de la entidad, otro de posicionamiento para almacenar dónde se encuentra, y el componente de dibujado en pantalla consulta esos valores y después hace su trabajo. Existen diferentes componentes de <em>renderizado</em>, en función de lo que se quiera dibujar en pantalla: una elipse, un rectángulo, una imagen fija o una imagen que varía en función de la acción que esté realizando la entidad. Todos estos componentes y sistemas se encuentran en el núcleo del proyecto, de modo que son utilizables desde cualquier juego o demo que desarrolle.</p>
        <p>La ventaja creo que se ve claramente. El código de los componentes solo existe una vez y es posible actualizar todas las entidades que lo usan de una sola tacada sin importar que estén en proyectos distintos. En caso de necesitar una versión anterior de un componente, siempre es posible recurrir a Maven para que nos eche un cable. O lo que es lo mismo, usar una versión anterior del motor para un juego concreto. Teniendo esto a nuestro alcance, sabemos que los juegos no tiene porqué ser actualizados conforme el motor evolucione. Además, siempre es posible heredar el comportamiento de un componente o sistema para realizar modificaciones sobre él, es decir, cada proyecto puede tener componentes propios que no se usen ningún otro proyecto.</p>
        <p>Al aplicar esta solución, las entidades no son más que una lista de componentes y sus parámetros de personalización y configuración, siendo la norma que incluyan la mínima cantidad de lógica posible. Lo más cómodo sería poder acceder a los distintos componentes por su tipo, dado que no es posible saber si una entidad tiene ese componente o no hasta preguntarle. Además, pueden existir dependencias entre los componentes. Por ejemplo, el componente de renderizado, requiere los componentes de posicionamiento y dimensión para poder funcionar. En caso de no disponer de alguno de ellos, no podrá hacer su trabajo correctamente por falta de información. Estos problemas quizás los discutamos en otra entrada.</p>
        <p>Por ahora, solo quería comentar en qué estoy metido y detallar un poco lo que estoy haciendo. Rehacer el sistema de colisiones con esta nueva estrategia tiene pinta de ser bastante más complejo de lo que pensaba, y es posible que requiera de más tiempo para alcanzar una solución aceptable.</p>
        <p>Me despido y hasta la próxima.</p>
        <p>Muchas gracias por leerme,<br>
          Lázarus Surazal.
        </p>
      </div>
      <link rel="stylesheet" type="text/css" href="static/css/relations.css" />
      <div id="relationsContainer">
        <span class="relatedTitle">Entradas relacionadas</span>
        <ul>
          <li><a href="md_2019_03_25.html">Power Shooter - Inicio de proyecto</a></li>
        </ul>
      </div>
      <link rel="stylesheet" type="text/css" href="static/css/navigation.css" />
      <hr>
      <div id="navigationContainer">
        <a class="item hint--bottom-left navigateButton right" href="md_2020_09_30.html" data-hint="Patrones de diseño - Introducción">
          Siguiente
          <i class="fa fa-arrow-right"></i>
        </a>
        <a class="item hint--bottom-right navigateButton left" href="md_2019_03_25.html" data-hint="Power Shooter - Inicio de proyecto">
          <i class="fa fa-arrow-left"></i>
          Anterior
        </a>
        <a class="navigateButton center" href="./">
          <i class="fa fa-home"></i>
          Volver a la página principal
        </a>
      </div>
      <link rel="stylesheet" type="text/css" href="static/css/info.css" />
      <div id="infoContainer">
        <div id="infoProfile" class="info_block">
          <div class="title">
            <b>Perfil</b>
          </div>
          <div class="content">
            <div class="part photo">
              <img src="media/images/logo_b.png" width="90px" alt="prLázarus logo info" />
            </div>
            <div class="part description">
              <h3 id="name">Carlos J. Peláez Rivas <em id="alias">(Lázarus Surazal)</em></h3>
              Graduado y Máster en Ingeniería Informática por la Universidad de Málaga (España). También cursé un Experto en tecnologías de Blockchain. Actualmente trabajando como Software engineer en Málaga.<br>
              Apasionado de los videojuegos, la música y la tecnología, siempre buscando cosas nuevas que aprender, hacer (y a veces romper).<br>
              <a href="https://cjpelaezrivas.dev">Más sobre mi...</a>
            </div>
          </div>
        </div>
        <div id="infoContact" class="info_block">
          <div class="title">
            <b>Contacto</b>
          </div>
          <div class="content links">
            <div class="item hint--bottom-right" data-hint="Perfil personal">
              <a href="https://cjpelaezrivas.dev" style="font-size: 38px; line-height: 38px;"><i class="fa fa-user-circle"></i></a>
            </div>
            <div class="item hint--bottom-right" data-hint="prLázarus - RSS">
              <a href="./feed.xml"><i class="fa fa-rss-square"></i></a>
            </div>
            <div class="item hint--bottom-right" data-hint="Enviar correo electrónico">
              <a href="mailto:prlazarus.info@gmail.com"><i class="fa fa-envelope-square"></i></a>
            </div>
            <div class="item hint--bottom-right" data-hint="Perfil de GitHub">
              <a href="https://github.com/cjpelaezrivas"><i class="fa fa-github-square"></i></a>
            </div>
            <div class="item hint--bottom-right" data-hint="Perfil de LinkedIn">
              <a href="https://www.linkedin.com/in/cjpelaezrivas"><i class="fa fa-linkedin-square"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div id="commentsContainer" style="float:left; width:100%;">
        <script src="https://utteranc.es/client.js" repo="cjpelaezrivas/prlazarus" issue-term="title" label="comments" theme="github-light" crossorigin="anonymous" async>
        </script>
        <noscript>
          <div class="block warning icon fa-exclamation" style="margin-bottom:20px;">
            Por favor, activa JavaScript para ver los comentarios.
          </div>
        </noscript>
      </div>
      <link rel="stylesheet" type="text/css" href="static/css/footer.css" />
      <div id="footer_message">
        ¿Has encontrado algún error? <a href="mailto:prlazarus.info@gmail.com">Envía un correo electrónico</a> o <a href="https://github.com/cjpelaezrivas/prLazarus/issues">abre un nuevo <i>issue</i></a> para corregirlo. Gracias.
      </div>
      <div id="footer">
        <div class="content">
          <div id="logo_footer">
            <a href="https://prlazarus.es"><img src="media/images/logo_c.png" alt="prLázarus logo footer" style="margin-top:10px;" /></a>

            <!-- <span class="text" style="display:block; text-align:center; margin-top:-4px;">© 2012 - 2018</span> -->
          </div>
          <div id="right_column" class="text">
            Desarrollado en <a href="https://es.wikipedia.org/wiki/Espa%C3%B1a"><img src="media/images/spain.png" style="margin: -2px 2px 0 2px;" alt="Spain flag" /></a> con <i class="fa fa-heart" style="color:#cc0000"></i> por <i><a href="https://prlazarus.es">prLázarus</a></i><br>
            <i class="fa fa-plug"></i> Con la tecnología de <i><a href="https://cjpelaezrivas.dev/Lighthouse/">Lighthouse</a></i> y <i><a href="https://pages.github.com/">GitHub Pages</a></i><br>
            <i><a href="./feed.xml">RSS</a></i>
            &nbsp;|&nbsp;
            <i><a href="md_cookies_policy.html">Política de cookies</a></i>
            &nbsp;|&nbsp;
            <i><a href="md_disclaimer.html">Limitación de responsabilidad</a></i><br>
            <a href="mailto:prlazarus.info@gmail.com">prlazarus.info@gmail.com</a>
          </div>
        </div>
      </div>
      <link rel="stylesheet" type="text/css" href="static/css/progressBar.css" />
      <div id="progressBarContainer">
        <div class="progressBar">
        </div>
      </div>
      <script src="js/progressBar.js"></script>
    </div>

    <!-- Default Statcounter code for prLázarus - Blog -->
    <script type="text/javascript">
      var sc_project = 12995152;
      var sc_invisible = 1;
      var sc_security = "7de2ea10";
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
      <div class="statcounter">
        <a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12995152/0/7de2ea10/1/" alt="Web Analytics" referrerPolicy="no-referrer-when-downgrade"></a>
      </div>
    </noscript>

    <!-- End of Statcounter Code -->
  </body>
</html>